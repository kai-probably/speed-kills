<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The diminishing return on driving fast.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --winwin:#22c55e;
      --sweet:#60a5fa;
      --plateau:#facc15;
      --risk:#f97373;
      --risk-strong:#ef4444;

      --bg:#f5f7fb;
      --card-bg:#ffffff;
      --text-main:#111827;
      --text-muted:#6b7280;
      --border-subtle:#e5e7eb;
    }

    *{ box-sizing:border-box; }

    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin:0;
      padding:1.5rem;
      background:var(--bg);
      color:var(--text-main);
    }

    .container{
      max-width:820px;
      margin:0 auto;
      background:var(--card-bg);
      border-radius:18px;
      padding:1.5rem 1.5rem 2rem;
      box-shadow:0 12px 30px rgba(15,23,42,0.08);
    }

    h1{
      font-size:1.4rem;
      margin:0 0 0.5rem;
    }

    .sub{
      font-size:0.9rem;
      color:var(--text-muted);
      margin-bottom:1.25rem;
    }

    /* Groups / wells */
    .well{
      border:1px solid var(--border-subtle);
      background:#f9fafb;
      border-radius:14px;
      padding:0.9rem;
      margin-bottom:1rem;
    }

    .well-title{
      font-size:0.8rem;
      color:var(--text-muted);
      margin:0 0 0.6rem;
      letter-spacing:0.01em;
    }

    /* Curve block inside well */
    .curve-block{
      padding:0.75rem 0.75rem 0.85rem;
      border-radius:12px;
      background:#ffffff;
      border:1px solid var(--border-subtle);
      margin-top:0.75rem;
    }

    .curve-header{
      font-size:0.8rem;
      color:var(--text-muted);
      margin-bottom:0.35rem;
    }

    .curve-legend{
      font-size:0.75rem;
      color:var(--text-muted);
      margin-top:0.25rem;
    }

    .curve-svg-wrapper{
      width:100%;
      height:130px;
    }

    .curve-svg{
      width:100%;
      height:100%;
      display:block;
    }

    /* Sliders */
    .slider-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:0.9rem;
      margin-bottom:0.4rem;
    }

    .slider-value{ font-weight:600; }

    .slider-row{ margin-bottom:0.6rem; }

    input[type="range"]{
      width:100%;
      -webkit-appearance:none;
      height:6px;
      border-radius:999px;
      background:#e5e7eb;
      outline:none;
    }

    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      appearance:none;
      width:18px;
      height:18px;
      border-radius:50%;
      background:#111827;
      cursor:pointer;
      box-shadow:0 0 0 3px rgba(17,24,39,0.12);
    }

    input[type="range"]::-moz-range-thumb{
      width:18px;
      height:18px;
      border-radius:50%;
      background:#111827;
      cursor:pointer;
      border:none;
      box-shadow:0 0 0 3px rgba(17,24,39,0.12);
    }

    /* Zone bar (speed) */
    .zone-bar{
      position:relative;
      display:flex;
      height:12px;
      border-radius:999px;
      overflow:hidden;
      border:1px solid var(--border-subtle);
      margin-top:0.4rem;
    }
    .zone-seg{ height:100%; }

    .zone-labels{
      display:flex;
      justify-content:space-between;
      font-size:0.7rem;
      color:var(--text-muted);
      margin-top:0.35rem;
    }

    .zone-pill{
      display:inline-flex;
      align-items:center;
      gap:0.25rem;
      padding:0.15rem 0.5rem;
      border-radius:999px;
      font-size:0.75rem;
      background:#e5e7eb;
      color:#374151;
      margin-top:0.55rem;
    }

    .zone-dot{
      width:7px;
      height:7px;
      border-radius:50%;
    }

    .zone-pill.winwin{ background:rgba(34,197,94,0.12); }
    .zone-pill.sweet{ background:rgba(59,130,246,0.12); }
    .zone-pill.plateau{ background:rgba(250,204,21,0.18); }
    .zone-pill.risk{ background:rgba(239,68,68,0.15); }
    .zone-pill.risk2{ background:rgba(239,68,68,0.25); }

    /* Cards */
    .cards{
      display:grid;
      grid-template-columns:repeat(2, minmax(0, 1fr));
      gap:0.9rem;
      margin-top:1.2rem;
    }

    @media (max-width:640px){
      .cards{ grid-template-columns:1fr; }
    }

    .card{
      background:#f9fafb;
      border-radius:14px;
      padding:0.9rem 0.9rem 1rem;
      border:1px solid var(--border-subtle);
    }

    .card-header{
      display:flex;
      align-items:center;
      gap:0.4rem;
      margin-bottom:0.35rem;
    }

    .card-icon{ font-size:1rem; }

    .card-label{
      font-size:0.8rem;
      color:var(--text-muted);
    }

    .card-value{
      font-size:1.3rem;
      font-weight:600;
      margin-bottom:0.15rem;
    }

    .card-sub{
      font-size:0.75rem;
      color:var(--text-muted);
      margin-top:0.1rem;
    }

    .card-value.good{ color:#16a34a; }
    .card-value.bad{ color:#dc2626; }

    .card-sub.good{ color:#16a34a; }
    .card-sub.bad{ color:#dc2626; }

    /* Remaining potential bar */
    .potential-wrapper{ margin-top:0.3rem; }

    .potential-bar-bg{
      width:100%;
      height:8px;
      border-radius:999px;
      background:#e5e7eb;
      overflow:hidden;
    }

    .potential-bar-fill{
      height:100%;
      width:50%;
      border-radius:999px;
      background:#22c55e;
      transition:width 0.2s ease-out, background-color 0.2s ease-out;
    }

    .potential-caption{
      margin-top:0.25rem;
      font-size:0.7rem;
      color:var(--text-muted);
    }
  </style>
</head>

<body>
<div class="container">
  <h1>How much time does driving faster actually save?</h1>
  <div class="sub">
    On the diminishing returns of faster travel and its impact on time and cost.
  </div>

  <!-- WELL 1: SPEED (primary) -->
  <div class="well">
    <div class="well-title">Efficiency</div>

    <div class="slider-header">
      <div>Speed</div>
      <div class="slider-value"><span id="speedLabel">100</span> km/h</div>
    </div>
    <div class="slider-row">
      <input id="speedSlider" type="range" min="30" max="200" step="1" value="100" />
    </div>

    <!-- Speed zones -->
    <div class="zone-bar">
      <div class="zone-seg" style="flex:20; background:#e5e7eb;"></div>
      <div class="zone-seg" style="flex:30; background:rgba(34,197,94,0.4);"></div>
      <div class="zone-seg" style="flex:20; background:rgba(59,130,246,0.4);"></div>
      <div class="zone-seg" style="flex:20; background:rgba(250,204,21,0.5);"></div>
      <div class="zone-seg" style="flex:20; background:rgba(249,115,115,0.6);"></div>
      <div class="zone-seg" style="flex:60; background:rgba(239,68,68,0.8);"></div>
    </div>

    <div class="zone-labels">
      <span>30</span><span>50</span><span>80</span><span>100</span><span>120</span><span>140</span><span>200</span>
    </div>

    <span id="zoneInfo" class="zone-pill">
      <span class="zone-dot" style="background:#9ca3af;"></span>
      Outside optimized zone
    </span>

    <!-- Curve lives inside the speed well -->
    <div class="curve-block">
      <div class="curve-header">
        Diminishing returns: time saved by the <strong>next 10 km/h</strong> (per 100 km)
      </div>
      <div class="curve-svg-wrapper">
        <svg class="curve-svg" viewBox="0 0 100 40">
          <defs>
            <linearGradient id="curveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#22c55e" />
              <stop offset="45%" stop-color="#4ade80" />
              <stop offset="75%" stop-color="#facc15" />
              <stop offset="100%" stop-color="#f97373" />
            </linearGradient>
          </defs>
          <line x1="0" y1="36" x2="100" y2="36" stroke="#e5e7eb" stroke-width="0.8" />
          <path id="deltaCurvePath" d="" fill="none" stroke="url(#curveGradient)" stroke-width="1.8" />
          <line id="deltaMarker" x1="0" y1="36" x2="0" y2="36" stroke="#111827" stroke-width="1.2" />
        </svg>
      </div>
      <div class="curve-legend">
        The curve is a rate (per 100 km). Trip context below scales the totals.
      </div>
    </div>
  </div>

  <!-- WELL 2: TRIP (secondary) -->
  <div class="well">
    <div class="well-title">Trip</div>

    <div class="slider-header">
      <div>Distance</div>
      <div class="slider-value"><span id="distanceLabel">100</span> km</div>
    </div>
    <div class="slider-row">
      <input id="distanceSlider" type="range" min="20" max="500" step="10" value="100" />
    </div>

    <div class="slider-header" style="margin-top:0.6rem;">
      <div>Fuel price</div>
      <div class="slider-value">‚Ç¨<span id="fuelPriceLabel">1.70</span> / L</div>
    </div>
    <div class="slider-row">
      <input id="fuelPriceSlider" type="range" min="1.20" max="2.50" step="0.01" value="1.70" />
    </div>
  </div>

  <!-- OUTPUT CARDS -->
  <div class="cards">
    <!-- a) Time saved by next 10 km/h -->
    <div class="card">
      <div class="card-header">
        <span class="card-icon">‚è≥</span>
        <span class="card-label">Time saved by going 10 km/h faster</span>
      </div>
      <div id="deltaStepMain" class="card-value">0.0 min</div>
      <div class="card-sub">Extra time saved per 100 km if you increase your speed by 10 km/h.</div>
      <div class="card-sub">
        On this trip:
        <span id="deltaTripValue">0.0 min</span>
      </div>
      <div class="card-sub">
        vs ideal 93.7 km/h:
        <span id="deltaIdealValue">0.0 min / 100 km</span>
      </div>
    </div>

    <!-- b) Remaining time-saving potential -->
    <div class="card">
      <div class="card-header">
        <span class="card-icon">üìâ</span>
        <span class="card-label">Remaining time-saving potential</span>
      </div>
      <div id="potentialValue" class="card-value">0%</div>
      <div class="potential-wrapper">
        <div class="potential-bar-bg">
          <div id="potentialBar" class="potential-bar-fill"></div>
        </div>
        <div class="potential-caption">
          How much improvement is still left in the speed curve
          (30 km/h = 100%, 200 km/h = 0%).
        </div>
      </div>
    </div>

    <!-- c) Fuel consumption (UPDATED: trip cost is primary) -->
    <div class="card">
      <div class="card-header">
        <span class="card-icon">‚õΩ</span>
        <span class="card-label">Fuel cost (this trip)</span>
      </div>

      <!-- Primary number -->
      <div id="fuelTripCostMain" class="card-value">‚Ç¨0.00</div>

      <div class="card-sub">Estimated fuel cost for the selected distance and speed.</div>

      <div class="card-sub">
        Fuel used:
        <span id="fuelTripValue">0.00 L</span>
      </div>

      <div class="card-sub">
        Fuel consumption:
        <span id="fuelPer100Small">0.00 L/100 km</span>
        ¬∑
        Cost per 100 km:
        <span id="fuelCostPer100">‚Ç¨0.00</span>
      </div>
    </div>

    <!-- d) Travel time (UPDATED: trip duration is primary) -->
    <div class="card">
      <div class="card-header">
        <span class="card-icon">‚è±Ô∏è</span>
        <span class="card-label">Trip duration</span>
      </div>

      <!-- Primary number -->
      <div id="tripDurationMain" class="card-value">0h 00m</div>

      <div class="card-sub">Total time for the selected distance at the current speed.</div>

      <div class="card-sub">
        Travel time per 100 km:
        <span id="timePer100Small">60.0 min</span>
      </div>
    </div>
  </div>
</div>

<script>
  const speedSlider = document.getElementById('speedSlider');
  const speedLabel = document.getElementById('speedLabel');

  const distanceSlider = document.getElementById('distanceSlider');
  const distanceLabel = document.getElementById('distanceLabel');

  const fuelPriceSlider = document.getElementById('fuelPriceSlider');
  const fuelPriceLabel = document.getElementById('fuelPriceLabel');

  // Travel time (now: trip duration is primary)
  const timePer100SmallEl = document.getElementById('timePer100Small');
  const tripDurationMainEl = document.getElementById('tripDurationMain');

  const deltaStepMainEl = document.getElementById('deltaStepMain');
  const deltaTripValueEl = document.getElementById('deltaTripValue');
  const deltaIdealValueEl = document.getElementById('deltaIdealValue');

  // Fuel (now: trip cost is primary)
  const fuelPer100SmallEl = document.getElementById('fuelPer100Small');
  const fuelTripValueEl = document.getElementById('fuelTripValue');
  const fuelTripCostMainEl = document.getElementById('fuelTripCostMain');
  const fuelCostPer100El = document.getElementById('fuelCostPer100');

  const zoneInfoEl = document.getElementById('zoneInfo');

  const potentialValueEl = document.getElementById('potentialValue');
  const potentialBarEl = document.getElementById('potentialBar');

  const deltaCurvePath = document.getElementById('deltaCurvePath');
  const deltaMarker = document.getElementById('deltaMarker');

  // --- Core constants ---
  const IDEAL_SPEED = 93.7; // km/h
  const t100Ideal = 6000 / IDEAL_SPEED; // minutes per 100 km

  const MIN_SPEED = 30;
  const MAX_SPEED = 200;

  // Potential normalization
  const t100Slow = 6000 / MIN_SPEED;
  const t100Fast = 6000 / MAX_SPEED;

  // --- Fuel model (baseline + aero penalty) ---
  // Baseline: 6.5 L/100 km @ 100 km/h
  // Fuel(v) = 6.5 * [0.55 + 0.45*(v/100)^2]
  const FUEL_100 = 6.5;
  const A_FIXED = 0.55;
  const A_AERO = 0.45;

  let maxAbsDeltaGlobal = 0;

  function clamp01(x){
    if (x < 0) return 0;
    if (x > 1) return 1;
    return x;
  }

  function deltaStepPer100(v){
    const nextV = Math.min(v + 10, MAX_SPEED);
    if (nextV <= v) return 0;
    const t100 = 6000 / v;
    const t100Next = 6000 / nextV;
    return t100Next - t100; // negative = time saved
  }

  function fuelPer100(v){
    const ratio = v / 100;
    const mult = A_FIXED + A_AERO * (ratio * ratio);
    return FUEL_100 * mult;
  }

  function formatHoursMinutes(totalMinutes){
    const mins = Math.max(0, Math.round(totalMinutes));
    const h = Math.floor(mins / 60);
    const m = mins % 60;
    return `${h}h ${String(m).padStart(2, '0')}m`;
  }

  function buildCurvePath(){
    const samples = [];
    const step = 5; // km/h sampling step
    maxAbsDeltaGlobal = 0;

    for (let v = MIN_SPEED; v <= MAX_SPEED - 10; v += step){
      const d = deltaStepPer100(v);
      const absD = Math.abs(d);
      if (absD > maxAbsDeltaGlobal) maxAbsDeltaGlobal = absD;
      samples.push({ v, d });
    }

    if (maxAbsDeltaGlobal === 0){
      deltaCurvePath.setAttribute('d', '');
      return;
    }

    let dAttr = '';
    samples.forEach((p, i) => {
      const xNorm = (p.v - MIN_SPEED) / (MAX_SPEED - MIN_SPEED);
      const x = xNorm * 100;
      const absD = Math.abs(p.d);
      const hNorm = absD / maxAbsDeltaGlobal;
      const h = hNorm * 34;
      const y = 36 - h;

      if (i === 0) dAttr += `M ${x.toFixed(2)} ${y.toFixed(2)}`;
      else dAttr += ` L ${x.toFixed(2)} ${y.toFixed(2)}`;
    });

    deltaCurvePath.setAttribute('d', dAttr);
  }

  function updateUI(){
    const v = parseInt(speedSlider.value, 10);
    const dist = parseInt(distanceSlider.value, 10);
    const fuelPrice = parseFloat(fuelPriceSlider.value);

    speedLabel.textContent = v;
    distanceLabel.textContent = dist;
    fuelPriceLabel.textContent = fuelPrice.toFixed(2);

    // Travel time per 100 km (secondary now)
    const t100 = 6000 / v;
    timePer100SmallEl.textContent = t100.toFixed(1) + ' min';

    // Trip duration (primary now)
    const tripMinutes = t100 * (dist / 100);
    tripDurationMainEl.textContent = formatHoursMinutes(tripMinutes);

    // Time vs ideal (per 100 km)
    const deltaIdeal = t100 - t100Ideal;
    let idealClass = 'card-sub';
    if (deltaIdeal > 0.1) idealClass += ' bad';
    else if (deltaIdeal < -0.1) idealClass += ' good';
    deltaIdealValueEl.className = idealClass;
    deltaIdealValueEl.textContent = `${Math.abs(deltaIdeal).toFixed(1)} min / 100 km`;

    // Next +10 km/h saving (per 100 km)
    const deltaStep = deltaStepPer100(v);
    let stepClass = 'card-value';
    if (deltaStep < -0.05) stepClass += ' good';
    else if (deltaStep > 0.05) stepClass += ' bad';

    const absStep = Math.abs(deltaStep);
    deltaStepMainEl.className = stepClass;
    deltaStepMainEl.textContent = `${absStep.toFixed(1)} min`;

    // Trip-scale saving for next +10 km/h
    deltaTripValueEl.className = stepClass.replace('card-value','card-sub');
    deltaTripValueEl.textContent = `${(absStep * (dist / 100)).toFixed(1)} min`;

    // Curve marker
    const xNorm = (v - MIN_SPEED) / (MAX_SPEED - MIN_SPEED);
    const x = xNorm * 100;

    let y = 36;
    if (maxAbsDeltaGlobal > 0){
      const hNorm = absStep / maxAbsDeltaGlobal;
      const h = hNorm * 34;
      y = Math.min(36 - Math.max(h, 1), 36);
    }
    deltaMarker.setAttribute('x1', x.toFixed(2));
    deltaMarker.setAttribute('x2', x.toFixed(2));
    deltaMarker.setAttribute('y1', y.toFixed(2));
    deltaMarker.setAttribute('y2', '36');

    // Fuel: rate + trip totals
    const f100 = fuelPer100(v);

    // Secondary fuel rate line
    fuelPer100SmallEl.textContent = f100.toFixed(2) + ' L/100 km';

    const tripLiters = f100 * (dist / 100);
    const tripCost = tripLiters * fuelPrice;
    const costPer100 = f100 * fuelPrice;

    fuelTripValueEl.textContent = `${tripLiters.toFixed(2)} L`;

    // Primary fuel number: trip cost
    fuelTripCostMainEl.textContent = `‚Ç¨${tripCost.toFixed(2)}`;

    fuelCostPer100El.textContent = `‚Ç¨${costPer100.toFixed(2)}`;

    // Remaining time-saving potential (speed curve only)
    const potentialRaw = (t100 - t100Fast) / (t100Slow - t100Fast);
    const potential = clamp01(potentialRaw);
    const potentialPercent = potential * 100;

    potentialValueEl.textContent = `${potentialPercent.toFixed(0)}%`;
    potentialBarEl.style.width = `${potentialPercent.toFixed(0)}%`;

    let barColor;
    if (potentialPercent > 60) barColor = '#22c55e';
    else if (potentialPercent > 30) barColor = '#f59e0b';
    else barColor = '#f97373';
    potentialBarEl.style.backgroundColor = barColor;

    // Zone labeling
    let zoneLabel = 'Outside optimized zone';
    let dotColor = '#9ca3af';
    zoneInfoEl.className = 'zone-pill';

    if (v >= 50 && v < 80){
      zoneLabel = 'Win‚Äìwin: faster & more efficient';
      dotColor = 'var(--winwin)';
      zoneInfoEl.classList.add('winwin');
    } else if (v >= 80 && v < 100){
      zoneLabel = 'Fuel-efficiency sweet spot';
      dotColor = 'var(--sweet)';
      zoneInfoEl.classList.add('sweet');
    } else if (v >= 100 && v < 120){
      zoneLabel = 'Time-efficiency plateau';
      dotColor = 'var(--plateau)';
      zoneInfoEl.classList.add('plateau');
    } else if (v >= 120 && v < 140){
      zoneLabel = 'High-speed region (risk rising)';
      dotColor = 'var(--risk)';
      zoneInfoEl.classList.add('risk');
    } else if (v >= 140){
      zoneLabel = 'Crash severity increases super-linearly';
      dotColor = 'var(--risk-strong)';
      zoneInfoEl.classList.add('risk2');
    }

    zoneInfoEl.innerHTML = `
      <span class="zone-dot" style="background:${dotColor};"></span>
      ${zoneLabel}
    `;
  }

  buildCurvePath();
  speedSlider.addEventListener('input', updateUI);
  distanceSlider.addEventListener('input', updateUI);
  fuelPriceSlider.addEventListener('input', updateUI);
  updateUI();
</script>
</body>
</html>
